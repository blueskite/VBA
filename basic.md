[TOP](.)

# VBAの基本
VBAで1つプログラムを作成してから実行するまでの流れをまとめます。([はじめに](intro)の環境設定は行っておいてください。)

例) A1～A10に1～10までの数字が入力されている。VBAを実行するボタンを押すとその合計値をC1に出力するとします。

## 1. マクロ関数(Sub)の作成とはじめての実行
マクロを実行するボタンをシートに配置します。
「開発」タブ＞「コントロールの挿入」＞左上のボタン
をクリックするとカーソルが矢印から十字になります。ドラッグして長方形を作るとボタンが作成されます。

![ボタン配置](images/basic_CreateButton.png)

「マクロの登録」というウィンドウが表示しマクロ関数(Sub)を指定もしくは新規登録することができます。
今回は、1つ目のマクロであることとわかりやすさからマクロ名を 「ボタン1_Click」から「Execute」に変更し「新規作成」を押します。
(executeは実行するという意味の英単語です。マクロ名は先頭は大文字で残りを小文字としてください)

![新規作成](images/basic_CreateSub.png)

つぎにコードを入力するウィンドウが表示されます。これを「Visual Basic エディタ 」(VBE)とよびます。
先程新規作成したExecuteというマクロ(Sub)がコード入力に表示されています。
左記のボタンをクリックすると、SubからEnd Subまでの間に記載したプログラムが実行されます。

### 最初のプログラムの入力
動作確認を兼ねてSubとEnd Subの間に以下のプログラムを入力してください。

```
Option Explicit

Sub Execute()
    MsgBox "テストです" 
End Sub
```

![最初のスクリプト](images/basic_EditSub.png)

上のツールバーにある再生ボタン(緑色の矢印)もしくは キーボードのF5を押すとこのプログラムが実行されます。
今回は、「テストです」と表示されるメッセージボックスが表示します。OKを押すと終了します。
メッセージボックスが表示されないときはどこかにエラーがあります。プログラムの文字が赤くなっていたらタイプミスなどが考えれられます。


次に プログラムを次のように修正し再生(F5)を行ってください。
このときVBエディタ下のイミディエイトウィンドウにDebug.Printで指定した文字列「テスト」が表示されます。

```
Option Explicit

Sub Execute()
    'MsgBox "テストです"
    Debug.Print "テスト"
End Sub
```

![Debug.Print](images/basic_ExecuteSub.png)

Excelに戻ってボタンに表示する文字や大きさ、位置を変更することができます。

* ボタンの周囲に白い四角(□)が表示されていないときは右クリックすると編集モードとなります。 
* 編集モードのときに文字をクリックすると変更でき、フォントや文字の大きさ、位置、ボタンの色なども変更できます。
* 変更が終わったらなにもないところをクリックすると白い四角が消えてボタンとして押せるようになります。
  (今回はボタンの文字を「実行」とし、大きさを文字がちょうどよく表示される大きさにします。) 

### コメントについて
シングルクオート(' : Shift + 数字の7)を入力するとそれ以降はコメント扱いとなりプログラムとして処理されません。
適宜プログラムの補助的な説明をコメント行として記載ください。

また複数行まとめてコメントアウトしたいときは、該当の行を選択してツールバーの「コメントブロック」をおすと行の先頭にシングルクオートがつきます。
コメントアウトをもとに戻したいときは右の「非コメントブロック」を押すとシングルクオートが除外されます。

![コメント](images/basic_Comment.png)

### まとめ) 1でしたこと

* ボタンの作成、調整
* マクロ関数(Sub)の作成
* MsgBox, Debug.Printによる文字の出力
* プログラムの実行
* コメント



---------------------------------

## 2. セルの値の取得して計算








---------------------------------

## その他
VBAの利用で知っておいたほうがよい基本的なことをまとめます。
プログラムを動かしながらデバッグする方法は [デバッグ](debug) を見てください。

### 未定義の変数があるとき必ずエラーにする
各プログラムの先頭に「Option Explict」を必ず記入してください。
これにより未定義の変数があるとプログラムエラーとなり、タイプミスを軽減することができます。

### モジュール名の変更
標準モジュールの名前はデフォルトで Module1 となっています。 標準モジュールを挿入するとModule2, Module3 と順に作成されます。
各モジュールの名前を変更することができます。わかりやすくするため最初のモジュールは「Main」 という名前に変更ください。

![モジュール名](images/basic_ModuleName.png)




```
書くこと
* Sub
* 変数と型 Dim
* メッセージボックス
* セル
  * 読み込み、書き込み
  * 属性 Row, Column, Value, Formula
* 別シートの読み書き
* ソースコードを見やすく (インデント、空行)
* With 構文
* 文字列連結 &
```


------------------


## もう少し詳しく

```
書くこと
* Private
* Array
* 別Excel, CSVファイルの読み込み
* 別ファイルへの書き込み、出力
* セルの色を変える Interior
* セルの値を削除 ClearContents
* 日付のセル
* 
```

