[TOP](.)

# VBAの基本
VBAで1つプログラムを作成してから実行するまでの流れをまとめます。([はじめに](intro)の環境設定は行っておいてください。)

例) A1～A10に1～10までの数字が入力されている。VBAを実行するボタンを押すとその合計値をC1に出力するとします。

## 1. マクロ関数(Sub)の作成とはじめての実行
マクロを実行するボタンをシートに配置します。
「開発」タブ＞「コントロールの挿入」＞左上のボタン
をクリックするとカーソルが矢印から十字になります。ドラッグして長方形を作るとボタンが作成されます。

![ボタン配置](images/basic_CreateButton.png)

「マクロの登録」というウィンドウが表示しマクロ関数(Sub)を指定もしくは新規登録することができます。
今回は、1つ目のマクロであることとわかりやすさからマクロ名を 「ボタン1_Click」から「Execute」に変更し「新規作成」を押します。
(executeは実行するという意味の英単語です。マクロ名は先頭は大文字で残りを小文字としてください)

![新規作成](images/basic_CreateSub.png)

つぎにコードを入力するウィンドウが表示されます。これを「Visual Basic エディタ 」(VBE)とよびます。
先程新規作成したExecuteというマクロ(Sub)がコード入力に表示されています。
左記のボタンをクリックすると、SubからEnd Subまでの間に記載したプログラムが実行されます。

### 最初のプログラムの入力
動作確認を兼ねてSubとEnd Subの間に以下のプログラムを入力してください。

```
Option Explicit

Sub Execute()
    MsgBox "テストです" 
End Sub
```

![最初のスクリプト](images/basic_EditSub.png)

上のツールバーにある再生ボタン(緑色の矢印)もしくは キーボードのF5を押すとこのプログラムが実行されます。
今回は、「テストです」と表示されるメッセージボックスが表示します。OKを押すと終了します。
メッセージボックスが表示されないときはどこかにエラーがあります。プログラムの文字が赤くなっていたらタイプミスなどが考えれられます。


次に プログラムを次のように修正し再生(F5)を行ってください。
このときVBエディタ下のイミディエイトウィンドウにDebug.Printで指定した文字列「テスト」が表示されます。

```
Option Explicit

Sub Execute()
    'MsgBox "テストです"
    Debug.Print "テスト"
End Sub
```

![Debug.Print](images/basic_ExecuteSub.png)

Excelに戻ってボタンに表示する文字や大きさ、位置を変更することができます。

* ボタンの周囲に白い四角(□)が表示されていないときは右クリックすると編集モードとなります。 
* 編集モードのときに文字をクリックすると変更でき、フォントや文字の大きさ、位置、ボタンの色なども変更できます。
* 変更が終わったらなにもないところをクリックすると白い四角が消えてボタンとして押せるようになります。
  (今回はボタンの文字を「実行」とし、大きさを文字がちょうどよく表示される大きさにします。) 

### コメントについて
シングルクオート(' : Shift + 数字の7)を入力するとそれ以降はコメント扱いとなりプログラムとして処理されません。
適宜プログラムの補助的な説明をコメント行として記載ください。

また複数行まとめてコメントアウトしたいときは、該当の行を選択してツールバーの「コメントブロック」をおすと行の先頭にシングルクオートがつきます。
コメントアウトをもとに戻したいときは右の「非コメントブロック」を押すとシングルクオートが除外されます。

![コメント](images/basic_Comment.png)

### まとめ) 1でしたこと

* ボタンの作成、調整
* マクロ関数(Sub)の作成
* MsgBox, Debug.Printによる文字の出力
* プログラムの実行
* コメント



---------------------------------

## 2. セルの値の取得して計算
ここではシートのA1～A10の値を順番に足して C1に出力するプログラムを検討します。
先程のDebug.Print 行以下に記入ください

合計値を保存する変数を定義します。

```
var total As Long
```
totalは初期値0の整数(32bit 最大値は約20億)の変数が定義されます。

```
Dim i As Long
For i = 1 To 10
    total = total + Cells(i, 1).Value  ' i行 1列(=A列)の値を順に足す
Next
```
For～Nextはその間の処理を繰り返します。このときiが1から10まで1つずつ増えていきます。
1つのセルの値は Cells(行番号,列番号).Value として取得することができます。

```
Cells(3, 1).Value = total
```
3行1列目のセル(=C1)に 合計値を記入します。

* これで再生ボタンを押するとエラーがなければ C1セルに 55 という値が設定されます。
* C1を一旦削除してから実行ボタンを押しても計算できることを確認してください。


## もう少し詳しく
### 変数の定義

VBAでよく使う変数の定義(型)を以下にまとめます。

|型     | 説明            | 備考                  | 
|-------|-----------------|-----------------------|
|Long   |整数             |-20億~+20億            |
|Double |倍精度浮動小数点数|                       |
|String |文字列           |                       |
|Date   |日付             |                       |
|Boolean|論理値           | True もしくはFalse       |
|Object |オブジェクト         | ここで上げたもの以外すべて  |
|Variant|ヴァリアント         |なんでも入れられる型       |

※ Integer という16bit(-32768~32767)の範囲の整数を利用することもできます。

入力例
```
Dim i As Long: i = 100    ' 整数のi に100を入力

Dim x as Double: x = 3.14

Dim s as String: s = "ABC"

Dim d as Date: d = #2017/1/4 12:14#  '日付をプログラムで設定するときは#で囲んでください

Dim b as Boolean: b = True

Dim dic As Object: Set dic = Create("Scripting.Dictionary")
' オブジェクトに値を設定するときは

Dim val   ' As～を省略するとvariant型にになります。必要なときのみこの記載としてください

```
※ 途中に: を入れると複数の文を1行に記入することができます。





