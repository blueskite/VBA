[TOP](.)

# VBAの基本
VBAで1つプログラムを作成してから実行するまでの流れをまとめます。
例) A1～A10に1～10までの数字が入力されている。VBAを実行するボタンを押すとその合計値をC1に出力するとします。

## 1. マクロ関数(Sub)の作成とはじめての実行
マクロを実行するボタンをシートに配置します。
「開発」タブ＞「コントロールの挿入」＞左上のボタン
をクリックするとカーソルが矢印から十字になります。ドラッグして長方形を作るとボタンが作成されます。

![ボタン配置](images/basic_CreateButton.png)

「マクロの登録」というウィンドウが表示しマクロ関数(Sub)を指定もしくは新規登録することができます。
今回は、1つ目のマクロであることとわかりやすさからマクロ名を 「ボタン1_Click」から「Execute」に変更し「新規作成」を押します。
(executeは実行するという意味の英単語です。マクロ名は先頭は大文字で残りを小文字としてください)

![新規作成](images/basic_CreateSub.png)

つぎにコードを入力するウィンドウが表示されます。これを「Visual Basic エディタ 」(VBE)とよびます。
先程新規作成したExecuteというマクロ(Sub)がコード入力に表示されています。
左記のボタンをクリックすると、SubからEnd Subまでの間に記載したプログラムが実行されます。

まずはSubの間に次のようにプログラムを記入してください。

```
Option Explicit

Sub Execute()
    MsgBox "テストです"
End Sub
```

![最初のスクリプト](images/basic_EditSub.png)

上のツールバーにある再生ボタン(緑色の矢印)もしくは キーボードのF5を押すとこのプログラムが実行されます。
今回は、「テストです」と表示されるメッセージボックスが表示します。OKを押すと終了します。

次に プログラムを次のように修正し再生(F5)を行ってください。
このときVBエディタ下のイミディエイトウィンドウにDebug.Printで指定した文字列「テスト」が表示されます。

```
Option Explicit

Sub Execute()
    'MsgBox "テストです"
    Debug.Print "テスト"
End Sub
```

シングルクオート(' : Shift + 数字の7)を入力するとそれ以降はコメント扱いとなりプログラムとして処理されません。
適宜プログラムの補助的な説明をコメント行として記載ください。

![Debug.Print](images/basic_ExecuteSub.png)

Excelに戻ってボタンに表示する文字や大きさを変更することができます。

* ボタンの周囲に白い四角(□)が表示されていないときは右クリックすると編集モードとなります。 
* 編集モードのときに文字をクリックすると変更でき、フォントや文字の大きさ、ボタンの色なども変更できます。
* 変更が終わったらなにもないところをクリックすると白い四角が消えてボタンとして押せるようになります。
  (今回はボタンの文字を「実行」とし、大きさを文字がちょうどよく表示される大きさにします。) 


---------------------------------

## 2. 





```
書くこと
* 標準モジュール
* Sub
* ボタン
* 変数と型 Dim
* イミディエイトウィンドウに出力
* メッセージボックス
* セル
  * 読み込み、書き込み
  * 属性 Row, Column, Value, Formula
* 別シートの読み書き
* コメント化
* ソースコードを見やすく (インデント、空行)
* With 構文
* 文字列連結 &
```


------------------


## もう少し詳しく

```
書くこと
* Option Explicit
* 複数の標準モジュール 
* Function
* Private
* Array
* 別Excel, CSVファイルの読み込み
* 別ファイルへの書き込み、出力
* セルの色を変える Interior
* セルの値を削除 ClearContents
* 日付のセル
* 
```

